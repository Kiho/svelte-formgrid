<Field :uuid :label bind:submit bind:error >
    <input type="text"
        ref:input 
        class="form-control {{inputClass}}" 
        id={{uuid}} 
        placeholder={{placeholder}} 
        bind:value="text"
        readonly="{{readOnly}}"
        required="{{required}}" 
        on:blur="blur(text)"         
    />
</Field>

<script>
    import { makeUniqueId, mergeProps, formatCurrency, debounce } from './utils'

    const toNumber = v => Number(v.replace(/[^0-9\.]+/g,""));

    import Field from './Field.html';
    import fieldBase from './field-base';

    export default {
        components: {
            Field
        },
        data() {
            return Object.assign({}, fieldBase.data(), {
                wait: 1000,
            });
        },
        oncreate() {
            fieldBase.oncreate(this);

            this.observe('value', value => {
                this.format(value);
            }, { init: true });

            const { wait } = this.get();
            if (wait) {
                this.observe('text', debounce((text) => {
                    // console.log('debounce', text);
                    if (text && text.indexOf('.') > -1) {
                        const num = toNumber(text);                    
                        if (num != 0 && !isNaN(num)) {
                            // console.log('num', num);
                            this.format(num);
                        }
                    }
                }, wait), { init: false });
            }
        },
        methods: {
            blur(text) {
                let num = text ? toNumber(text) : 0;
                // TODO validation message
                if (!isNaN(num)) {
                   this.format(num);
                }
            },
            format(value) {
                const text = formatCurrency(value);
                this.set({ text });	
            },
            unformat(text) {
                const num = text ? toNumber(text) : 0;
                this.set({ value: num });
            },
        }
    }
</script>
